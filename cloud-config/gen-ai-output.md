# Gen AI Terraform Output
The following output was generated by GenAI and can be used as a starting point (or sanity check) the custom Terraform code in the modules and environments.

## Prompt
You're a Google Cloud architect designing a secure landing zone for your organization and want your serverless Cloud Run service to communicate over private network to both Cloud SQL Postgres 15 database and Cloud Memorystore Redis database. The Cloud Run service should only communicate internally or via load balancer and use a custom domain myapp.example.com; Please generate the Terraform code using version 1.5.7 for the following:

- vpc network name: example-network
- reserved range name: google-managed-range
- reserved range cidr: 10.100.0.0/16
- serverless connector subnet: serverless-connector
- serverless connector cidr: 10.249.0.0/28
- service account: example-compute
- redis instance: example-cache
- database instance: example-db-instance
- database version: postgresql 15
- database plugin: pgvector
- cloud run service: myapp
- global application load balancer: example-lb

## Output (after a few interactions)

```hcl
provider "google" {
  version = "3.5.0"
  credentials = file("<PATH_TO_YOUR_SERVICE_ACCOUNT_KEY>")
  project = "<YOUR_PROJECT_ID>"
  region  = "us-central1"
  zone    = "us-central1-c"
}

resource "google_compute_network" "vpc_network" {
  name                    = "example-network"
  auto_create_subnetworks = false
}

resource "google_compute_global_address" "google_managed_range" {
  name          = "google-managed-range"
  purpose       = "VPC_PEERING"
  address_type  = "INTERNAL"
  prefix_length = 16
  network       = google_compute_network.vpc_network.self_link
}

resource "google_compute_network_peering" "peering" {
  name         = "peering"
  network      = google_compute_network.vpc_network.self_link
  peer_network = "https://www.googleapis.com/compute/v1/projects/servicenetworking/global/networks/service-peering"
}

resource "google_compute_subnetwork" "serverless_connector" {
  name          = "serverless-connector"
  ip_cidr_range = "10.249.0.0/28"
  network       = google_compute_network.vpc_network.self_link
}

resource "google_redis_instance" "example_cache" {
  name           = "example-cache"
  memory_size_gb = 1
  location_id    = "us-central1"
  redis_version  = "REDIS_5_0"
  network        = google_compute_network.vpc_network.self_link
}

resource "google_sql_database_instance" "example_db_instance" {
  name             = "example-db-instance"
  database_version = "POSTGRES_15"
  region           = "us-central1"

  settings {
    tier = "db-f1-micro"
  }
}

resource "google_service_account" "example_compute" {
  account_id   = "example-compute"
  display_name = "example-compute"
}

resource "google_vpc_access_connector" "vpc_connector" {
  name          = "vpc-connector"
  region        = "us-central1"
  ip_cidr_range = "10.249.0.0/28"
  network       = google_compute_network.vpc_network.name

  subnet {
    name = google_compute_subnetwork.serverless_connector.name
  }
}

resource "google_cloud_run_service" "myapp" {
  name     = "myapp"
  location = "us-central1"

  template {
    spec {
      containers {
        image = "gcr.io/cloudrun/hello"
      }

      service_account_name = google_service_account.example_compute.email

      volumes {
        name = "pgvector"
        volume {
          secret {
            secret_name = "pgvector"
          }
        }
      }
    }
  }

  traffic {
    percent         = 100
    latest_revision = true
  }

  template {
    spec {
      containers {
        resources {
          limits = {
            cpu    = "1000m"
            memory = "512Mi"
          }
        }
      }
    }
  }

  metadata {
    annotations = {
      "run.googleapis.com/vpc-access-connector" = google_vpc_access_connector.vpc_connector.name
    }
  }
}

resource "google_compute_global_forwarding_rule" "example_lb" {
  name       = "example-lb"
  target     = google_compute_target_http_proxy.default.self_link
  port_range = "80"
  ip_address = google_compute_global_address.default.address
}
```
